angular.module("Loupe.Angular",[]).factory("loupe.logService",["$log","$window","$injector","loupe.stacktraceService","loupe.platformService",function(a,b,c,d,e){function f(a,b,c,d){this.file=a||null,this.method=b||null,this.line=c||null,this.column=d||null}function g(a){var b=Array.prototype.slice,c=b.call(arguments,1);return function(){return a.apply(this,c.concat(b.call(arguments,0)))}}function h(){var a,b="_loupe_storage_test_";try{localStorage.setItem(b,b),a=!0}catch(c){a=!1}if(a)try{localStorage.removeItem(b)}catch(c){a=!1}return a}function i(){if(O&&localStorage.length||N.length){var a=c.get("$timeout");a(x,10)}}function j(){return{headerName:"loupe-client-session",headerValue:M}}function k(){var a=m();a?M=a:(M=F(),l(M))}function l(a){if(O)try{sessionStorage.setItem("LoupeClientSessionId",a)}catch(b){consoleLog("Unable to store clientSessionId in session storage. "+b.message)}}function m(){try{var a=sessionStorage.getItem("LoupeClientSessionId");if(a)return a}catch(b){consoleLog("Unable to retrieve clientSessionId number from session storage. "+b.message)}return null}function n(){var a=p();K=-1===a&&O?0:a}function o(){var a;return O&&(a=p(),K>a&&(a=K),-1!=a&&(a++,q(a)))?K=a:(K++,K)}function p(){if(O)try{var b=sessionStorage.getItem("LoupeSequenceNumber");return b?parseInt(b):0}catch(c){a.log("Unable to retrieve sequence number from session storage. "+c.message)}return-1}function q(b){try{return sessionStorage.setItem("LoupeSequenceNumber",b),!0}catch(c){return a.log("Unable to store sequence number. "+c.message),!1}}function r(){var a;try{var b=c.get("$location");return a=c.get("$route"),"undefined"==typeof a||null===a?null:{controller:a.current.$$route.controller,name:"",url:b.absUrl(),templateUrl:a.current.loadedTemplateUrl,parameters:[]}}catch(d){return null}}function s(){var a;try{return a=c.get("$state"),"undefined"==typeof a||null===a?null:{controller:a.current.controller,name:a.current.name,url:a.current.url,templateUrl:a.current.templateUrl,parameters:a.params}}catch(b){return null}}function t(){var a=c.get("$location");return{controller:"",name:"",url:a.absUrl(),templateUrl:"",parameters:[]}}function u(){var a=r();if(null!==a)return a;var b=s();return null!==b?b:t()}function v(b){try{return d.print({e:b,guess:!0})}catch(c){a.log(c)}return null}function w(b){for(var c=0;c<b.length;c++)try{localStorage.removeItem(b[c])}catch(d){a.log("Unable to remove message from localStorage: "+d.message)}}function x(){var a=G(),b=a[0],c=a[1];if(b.length){var d={session:{client:e.platform()},logMessages:b};y(d,c)}}function y(b,d){var e=c.get("$http");e.post("/Loupe/Log",angular.toJson(b)).success(function(a,b){(200===b||204===b&&d.length)&&w(d)}).error(function(b,c,d,e){a.warn("Loupe Angular Logger: Exception while attempting to log"),a.log("  status: "+c),a.log("  data: "+b)})}function z(c,d){try{var e,f=u(),g=c.toString(),h=v(c);if(f){var i={controller:f.controller,page:{routeName:f.name,routeUrl:f.url,controller:f.controller,templateUrl:f.templateUrl,parameters:f.parameters}};e=JSON.stringify(i)}var j={message:g,url:b.location.href,stackTrace:h,cause:d||"",line:null,column:null};B(P.error,"JavaScript","","",null,e,j,null),x()}catch(k){a.warn("Error logging failed"),a.log(k)}}function A(a){return new f(a.file||null,a.method||null,a.line||null,a.column||null)}function B(a,b,c,d,e,g,h,i){var j=o(),k=E();h&&(h=D(h)),!i||i instanceof f||(i=A(i));var l={severity:a,category:b,caption:c,description:d,parameters:e,details:g,exception:h,methodSourceInfo:i,timeStamp:k,sequence:j,agentSessionId:M,sessionId:L};C(l)}function C(b){if(O)try{localStorage.setItem("Loupe-message-"+F(),JSON.stringify(b))}catch(c){N.push(b),a.log("Error attempting to store Loupe log message in local storage. "+c.message)}else N.push(b)}function D(a,c){return"url"in a?a:{message:a.message,url:b.location.href,stackTrace:a.stackTrace,cause:c||"",line:a.lineNumber,column:a.columnNumber}}function E(){var a=new Date,b=-a.getTimezoneOffset(),c=b>=0?"+":"-",d=function(a){var b=Math.abs(Math.floor(a));return(10>b?"0":"")+b};return a.getFullYear()+"-"+d(a.getMonth()+1)+"-"+d(a.getDate())+"T"+d(a.getHours())+":"+d(a.getMinutes())+":"+d(a.getSeconds())+c+d(b/60)+":"+d(b%60)}function F(){var a=Date.now(),b="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(b){var c=(a+16*Math.random())%16|0;return a=Math.floor(a/16),("x"==b?c:3&c|8).toString(16)});return b}function G(){var a=[],b=[];if(N.length&&(a=N.slice(),N.length=0),O){for(var c=0;c<localStorage.length;c++)localStorage.key(c).indexOf("Loupe-message-")>-1&&(b.push(localStorage.key(c)),a.push(JSON.parse(localStorage.getItem(localStorage.key(c)))));a.length&&a.length>1&&a.sort(function(a,b){return a.sequence-b.sequence})}return[a,b]}function H(a){return"undefined"==typeof a?null:a}function I(a,b,c,d,e,f,g,h){f=H(f),g=H(g),h=H(h),B(a,b,c,d,e,g,f,h),i()}function J(a){L=a}var K,L,M,N=[],O=h(),P={none:0,critical:1,error:2,warning:4,information:8,verbose:16};k(),n(),i();var Q=g(I,P.verbose),R=g(I,P.information),S=g(I,P.warning),T=g(I,P.error),U=g(I,P.critical),V={exception:z,write:I,verbose:Q,information:R,warning:S,error:T,critical:U,logMessageSeverity:P,setSessionId:J,clientSessionHeader:j,MethodSourceInfo:f};return V}]).factory("loupe.stacktraceService",["$log",function(a){function b(a){if(f)try{var b=f(a).reverse();return c(b)}catch(d){}return[]}function c(a){if(a){var b=d(a);b>0&&(a=a.slice(b))}return a}function d(a){for(var b=["getStackTrace","createStackTrace","printStackTrace"],c=0,d=0,e=0;e<a.length;e++)a[e].indexOf(b[d])>-1&&(d++,c=e);return c>0&&c++,c}function e(){function a(b){b=b||{guess:!0};var c=b.e||null,d=!!b.guess,e=new a.implementation,f=e.run(c);return d?e.guessAnonymousFunctions(f):f}return a.implementation=function(){},a.implementation.prototype={run:function(a,b){return a=a||this.createException(),b=b||this.mode(a),"other"===b?this.other(arguments.callee):this[b](a)},createException:function(){try{this.undef()}catch(a){return a}},mode:function(a){return a.arguments&&a.stack?"chrome":a.stack&&a.sourceURL?"safari":a.stack&&a.number?"ie":a.stack&&a.fileName?"firefox":a.message&&a["opera#sourceloc"]?a.stacktrace?a.message.indexOf("\n")>-1&&a.message.split("\n").length>a.stacktrace.split("\n").length?"opera9":"opera10a":"opera9":a.message&&a.stack&&a.stacktrace?a.stacktrace.indexOf("called from line")<0?"opera10b":"opera11":a.stack&&!a.fileName?"chrome":"other"},instrumentFunction:function(b,c,d){b=b||window;var e=b[c];b[c]=function(){return d.call(this,a().slice(4)),b[c]._instrumented.apply(this,arguments)},b[c]._instrumented=e},deinstrumentFunction:function(a,b){a[b].constructor===Function&&a[b]._instrumented&&a[b]._instrumented.constructor===Function&&(a[b]=a[b]._instrumented)},chrome:function(a){return(a.stack+"\n").replace(/^[\s\S]+?\s+at\s+/," at ").replace(/^\s+(at eval )?at\s+/gm,"").replace(/^([^\(]+?)([\n$])/gm,"{anonymous}() ($1)$2").replace(/^Object.<anonymous>\s*\(([^\)]+)\)/gm,"{anonymous}() ($1)").replace(/^(.+) \((.+)\)$/gm,"$1@$2").split("\n").slice(0,-1)},safari:function(a){return a.stack.replace(/\[native code\]\n/m,"").replace(/^(?=\w+Error\:).*$\n/m,"").replace(/^@/gm,"{anonymous}()@").split("\n")},ie:function(a){return a.stack.replace(/^\s*at\s+(.*)$/gm,"$1").replace(/^Anonymous function\s+/gm,"{anonymous}() ").replace(/^(.+)\s+\((.+)\)$/gm,"$1@$2").split("\n").slice(1)},firefox:function(a){return a.stack.replace(/(?:\n@:0)?\s+$/m,"").replace(/^(?:\((\S*)\))?@/gm,"{anonymous}($1)@").split("\n")},opera11:function(a){for(var b="{anonymous}",c=/^.*line (\d+), column (\d+)(?: in (.+))? in (\S+):$/,d=a.stacktrace.split("\n"),e=[],f=0,g=d.length;g>f;f+=2){var h=c.exec(d[f]);if(h){var i=h[4]+":"+h[1]+":"+h[2],j=h[3]||"global code";j=j.replace(/<anonymous function: (\S+)>/,"$1").replace(/<anonymous function>/,b),e.push(j+"@"+i+" -- "+d[f+1].replace(/^\s+/,""))}}return e},opera10b:function(a){for(var b=/^(.*)@(.+):(\d+)$/,c=a.stacktrace.split("\n"),d=[],e=0,f=c.length;f>e;e++){var g=b.exec(c[e]);if(g){var h=g[1]?g[1]+"()":"global code";d.push(h+"@"+g[2]+":"+g[3])}}return d},opera10a:function(a){for(var b="{anonymous}",c=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i,d=a.stacktrace.split("\n"),e=[],f=0,g=d.length;g>f;f+=2){var h=c.exec(d[f]);if(h){var i=h[3]||b;e.push(i+"()@"+h[2]+":"+h[1]+" -- "+d[f+1].replace(/^\s+/,""))}}return e},opera9:function(a){for(var b="{anonymous}",c=/Line (\d+).*script (?:in )?(\S+)/i,d=a.message.split("\n"),e=[],f=2,g=d.length;g>f;f+=2){var h=c.exec(d[f]);h&&e.push(b+"()@"+h[2]+":"+h[1]+" -- "+d[f+1].replace(/^\s+/,""))}return e},other:function(a){for(var b,c,d="{anonymous}",e=/function(?:\s+([\w$]+))?\s*\(/,f=[],g=10,h=Array.prototype.slice;a&&f.length<g;){b=e.test(a.toString())?RegExp.$1||d:d;try{c=h.call(a.arguments||[])}catch(i){c=["Cannot access arguments: "+i]}f[f.length]=b+"("+this.stringifyArguments(c)+")";try{a=a.caller}catch(i){f[f.length]="Cannot access caller: "+i;break}}return f},stringifyArguments:function(a){for(var b=[],c=Array.prototype.slice,d=0;d<a.length;++d){var e=a[d];void 0===e?b[d]="undefined":null===e?b[d]="null":e.constructor&&(e.constructor===Array?e.length<3?b[d]="["+this.stringifyArguments(e)+"]":b[d]="["+this.stringifyArguments(c.call(e,0,1))+"..."+this.stringifyArguments(c.call(e,-1))+"]":e.constructor===Object?b[d]="#object":e.constructor===Function?b[d]="#function":e.constructor===String?b[d]='"'+e+'"':e.constructor===Number?b[d]=e:b[d]="?")}return b.join(",")},sourceCache:{},ajax:function(a){var b=this.createXMLHTTPObject();if(b)try{return b.open("GET",a,!1),b.send(null),b.responseText}catch(c){}return""},createXMLHTTPObject:function(){for(var a,b=[function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}],c=0;c<b.length;c++)try{return a=b[c](),this.createXMLHTTPObject=b[c],a}catch(d){}},isSameDomain:function(a){return"undefined"!=typeof location&&-1!==a.indexOf(location.hostname)},getSource:function(a){return a in this.sourceCache||(this.sourceCache[a]=this.ajax(a).split("\n")),this.sourceCache[a]},guessAnonymousFunctions:function(a){for(var b=0;b<a.length;++b){var c=/\{anonymous\}\(.*\)@(.*)/,d=/^(.*?)(?::(\d+))(?::(\d+))?(?: -- .+)?$/,e=a[b],f=c.exec(e);if(f){var g=d.exec(f[1]);if(g){var h=g[1],i=g[2],j=g[3]||0;if(h&&this.isSameDomain(h)&&i){var k=this.guessAnonymousFunction(h,i,j);a[b]=e.replace("{anonymous}",k)}}}}return a},guessAnonymousFunction:function(a,b,c){var d;try{d=this.findFunctionName(this.getSource(a),b)}catch(e){d="getSource failed with url: "+a+", exception: "+e.toString()}return d},findFunctionName:function(a,b){for(var c,d,e,f=/function\s+([^(]*?)\s*\(([^)]*)\)/,g=/['"]?([$_A-Za-z][$_A-Za-z0-9]*)['"]?\s*[:=]\s*function\b/,h=/['"]?([$_A-Za-z][$_A-Za-z0-9]*)['"]?\s*[:=]\s*(?:eval|new Function)\b/,i="",j=Math.min(b,20),k=0;j>k;++k)if(c=a[b-k-1],e=c.indexOf("//"),e>=0&&(c=c.substr(0,e)),c){if(i=c+i,d=g.exec(i),d&&d[1])return d[1];if(d=f.exec(i),d&&d[1])return d[1];if(d=h.exec(i),d&&d[1])return d[1]}return"(?)"}},a}try{var f=new e}catch(g){a("Unable to setup stack trace capture functionaliyt: "+g.message),f=null}return{print:b}}]).factory("loupe.platformService",function(){function a(){var a=c;return a.size={width:window.innerWidth||document.body.clientWidth,height:window.innerHeight||document.body.clientHeight},a}function b(){"use strict";function a(a){return a=String(a),a.charAt(0).toUpperCase()+a.slice(1)}function b(a,b){var c=-1,e=a?a.length:0;if("number"==typeof e&&e>-1&&n>=e)for(;++c<e;)b(a[c],c,a);else d(a,b)}function c(b){return b=i(b),/^(?:webOS|i(?:OS|P))/.test(b)?b:a(b)}function d(a,b){for(var c in a)r.call(a,c)&&b(a[c],c,a)}function e(b){return null==b?a(b):s.call(b).slice(8,-1)}function f(a,b){var c=null!=a?typeof a[b]:"number";return!/^(?:boolean|number|string|undefined)$/.test(c)&&("object"==c?!!a[b]:!0)}function g(a){return String(a).replace(/([ -])(?!$)/g,"$1?")}function h(a,c){var d=null;return b(a,function(b,e){d=c(d,b,e,a)}),d}function i(a){return String(a).replace(/^ +| +$/g,"")}function j(a){function b(b){return h(b,function(b,c){return b||RegExp("\\b"+(c.pattern||g(c))+"\\b","i").exec(a)&&(c.label||c)})}function k(b){return h(b,function(b,c,d){return b||(c[W]||c[/^[a-z]+(?: +[a-z]+\b)*/i.exec(W)]||RegExp("\\b"+g(d)+"(?:\\b|\\w*\\d)","i").exec(a))&&d})}function n(b){return h(b,function(b,c){return b||RegExp("\\b"+(c.pattern||g(c))+"\\b","i").exec(a)&&(c.label||c)})}function q(b){return h(b,function(b,d){var e=d.pattern||g(d);return!b&&(b=RegExp("\\b"+e+"(?:/[\\d.]+|[ \\w.]*)","i").exec(a))&&(z={6.3:"8.1",6.2:"8",6.1:"Server 2008 R2 / 7","6.0":"Server 2008 / Vista",5.2:"Server 2003 / XP 64-bit",5.1:"XP",5.01:"2000 SP1","5.0":"2000","4.0":"NT","4.90":"ME"},/^Win/i.test(b)&&(z=z[/[\d.]+$/.exec(b)])&&(b="Windows "+z,A="Server 2008 R2 / 7"==z),b=c(String(b).replace(RegExp(e,"i"),d.label||d).replace(/ ce$/i," CE").replace(/hpw/i,"web").replace(/Macintosh/,"Mac OS").replace(/_PowerPC/i," OS").replace(/(OS X) [^ \d]+/i,"$1").replace(/Mac (OS X)/,"$1").replace(/\/(\d)/," $1").replace(/_/g,".").replace(/(?: BePC|[ .]*fc[ \d.]+)$/i,"").replace(/x86\.64/gi,"x86_64").replace(/(Windows Phone)(?! OS)/,"$1 OS").split(" on ")[0])),b})}function r(b){return h(b,function(b,d){var e=d.pattern||g(d);return!b&&(b=RegExp("\\b"+e+" *\\d+[.\\w_]*","i").exec(a)||RegExp("\\b"+e+"(?:; *(?:[a-z]+[_-])?[a-z]+\\d+|[^ ();-]*)","i").exec(a))&&((b=String(d.label&&!RegExp(e,"i").test(d.label)?d.label:b).split("/"))[1]&&!/[\d.]+/.test(b[0])&&(b[0]+=" "+b[1]),d=d.label||d,b=c(b[0].replace(RegExp(e,"i"),d).replace(RegExp("; *(?:"+d+"[_-])?","i")," ").replace(RegExp("("+d+")[-_.]?(\\w)","i"),"$1 $2"))),b})}function t(b){return h(b,function(b,c){return b||(RegExp(c+"(?:-[\\d.]+/|(?: for [\\w-]+)?[ /-])([\\d.]+[^ ();/_-]*)","i").exec(a)||0)[1]||null})}function u(){return this.description||""}var v=l,w=a&&"object"==typeof a&&"String"!=e(a);w&&(v=a,a=null);var x=v.navigator||{},y=x.userAgent||"";a||(a=y);var z,A,B=w||p==m,C=w?!!x.likeChrome:/\bChrome\b/.test(a)&&!/internal|\n/i.test(s.toString()),D="Object",E=w?D:"ScriptBridgingProxyObject",F=w?D:"Environment",G=w&&v.java?"JavaPackage":e(v.java),H=w?D:"RuntimeObject",I=/Java/.test(G)&&v.java,J=I&&e(v.environment)==F,K=I?"a":"α",L=I?"b":"β",M=v.document||{},N=v.operamini||v.opera,O=o.test(O=w&&N?N["[[Class]]"]:e(N))?O:N=null,P=a,Q=[],R=null,S=a==y,T=S&&N&&"function"==typeof N.version&&N.version(),U=b([{label:"WebKit",pattern:"AppleWebKit"},"iCab","Presto","NetFront","Tasman","Trident","KHTML","Gecko"]),V=n(["Adobe AIR","Arora","Avant Browser","Camino","Epiphany","Fennec","Flock","Galeon","GreenBrowser","iCab","Iceweasel",{label:"SRWare Iron",pattern:"Iron"},"K-Meleon","Konqueror","Lunascape","Maxthon","Midori","Nook Browser","PhantomJS","Raven","Rekonq","RockMelt","SeaMonkey",{label:"Silk",pattern:"(?:Cloud9|Silk-Accelerated)"},"Sleipnir","SlimBrowser","Sunrise","Swiftfox","WebPositive","Opera Mini","Opera",{label:"Opera",pattern:"OPR"},"Chrome",{label:"Chrome Mobile",pattern:"(?:CriOS|CrMo)"},{label:"Firefox",pattern:"(?:Firefox|Minefield)"},{label:"IE",pattern:"MSIE"},"Safari"]),W=r([{label:"BlackBerry",pattern:"BB10"},"BlackBerry",{label:"Galaxy S",pattern:"GT-I9000"},{label:"Galaxy S2",pattern:"GT-I9100"},{label:"Galaxy S3",pattern:"GT-I9300"},{label:"Galaxy S4",pattern:"GT-I9500"},"Google TV","iPad","iPod","iPhone","Kindle",{label:"Kindle Fire",pattern:"(?:Cloud9|Silk-Accelerated)"},"Nook","PlayBook","PlayStation 4","PlayStation 3","PlayStation Vita","TouchPad","Transformer",{label:"Wii U",pattern:"WiiU"},"Wii","Xbox One",{label:"Xbox 360",pattern:"Xbox"},"Xoom"]),X=k({Apple:{iPad:1,iPhone:1,iPod:1},Amazon:{Kindle:1,"Kindle Fire":1},Asus:{Transformer:1},"Barnes & Noble":{Nook:1},BlackBerry:{PlayBook:1},Google:{"Google TV":1},HP:{TouchPad:1},HTC:{},LG:{},Microsoft:{Xbox:1,"Xbox One":1},Motorola:{Xoom:1},Nintendo:{"Wii U":1,Wii:1},Nokia:{},Samsung:{"Galaxy S":1,"Galaxy S2":1,"Galaxy S3":1,"Galaxy S4":1},Sony:{"PlayStation 4":1,"PlayStation 3":1,"PlayStation Vita":1}}),Y=q(["Android","CentOS","Debian","Fedora","FreeBSD","Gentoo","Haiku","Kubuntu","Linux Mint","Red Hat","SuSE","Ubuntu","Xubuntu","Cygwin","Symbian OS","hpwOS","webOS ","webOS","Tablet OS","Linux","Mac OS X","Macintosh","Mac","Windows 98;","Windows "]);if(U&&(U=[U]),X&&!W&&(W=r([X])),(z=/Google TV/.exec(W))&&(W=z[0]),/\bSimulator\b/i.test(a)&&(W=(W?W+" ":"")+"Simulator"),/^iP/.test(W)?(V||(V="Safari"),Y="iOS"+((z=/ OS ([\d_]+)/i.exec(a))?" "+z[1].replace(/_/g,"."):"")):"Konqueror"!=V||/buntu/i.test(Y)?X&&"Google"!=X&&(/Chrome/.test(V)&&!/Mobile Safari/.test(a)||/Vita/.test(W))?(V="Android Browser",Y=/Android/.test(Y)?Y:"Android"):(!V||(z=!/\bMinefield\b|\(Android;/i.test(a)&&/Firefox|Safari/.exec(V)))&&(V&&!W&&/[\/,]|^[^(]+?\)/.test(a.slice(a.indexOf(z+"/")+8))&&(V=null),(z=W||X||Y)&&(W||X||/Android|Symbian OS|Tablet OS|webOS/.test(Y))&&(V=/[a-z]+(?: Hat)?/i.exec(/Android/.test(Y)?Y:z)+" Browser")):Y="Kubuntu",(z=/\((Mobile|Tablet).*?Firefox/i.exec(a))&&z[1]&&(Y="Firefox OS",W||(W=z[1])),T||(T=t(["(?:Cloud9|CriOS|CrMo|Iron|Opera ?Mini|OPR|Raven|Silk(?!/[\\d.]+$))","Version",g(V),"(?:Firefox|Minefield|NetFront)"])),"iCab"==U&&parseFloat(T)>3?U=["WebKit"]:(z=/Opera/.test(V)&&(/OPR/.test(a)?"Blink":"Presto")||/\b(?:Midori|Nook|Safari)\b/i.test(a)&&"WebKit"||!U&&/\bMSIE\b/i.test(a)&&("Mac OS"==Y?"Tasman":"Trident"))?U=[z]:/PlayStation(?! Vita)/i.test(V)&&"WebKit"==U&&(U=["NetFront"]),"IE"!=V&&"Trident"==U&&(z=/\brv:([\d.]+)/.exec(a))&&(V&&Q.push("identifying as "+V+(T?" "+T:"")),V="IE",T=z[1]),S){if(f(v,"global"))if(I&&(z=I.lang.System,P=z.getProperty("os.arch"),Y=Y||z.getProperty("os.name")+" "+z.getProperty("os.version")),B&&f(v,"system")&&(z=[v.system])[0]){Y||(Y=z[0].os||null);try{z[1]=v.require("ringo/engine").version,T=z[1].join("."),V="RingoJS"}catch(Z){z[0].global.system==v.system&&(V="Narwhal")}}else"object"==typeof v.process&&(z=v.process)?(V="Node.js",P=z.arch,Y=z.platform,T=/[\d.]+/.exec(z.version)[0]):J&&(V="Rhino");else e(z=v.runtime)==E?(V="Adobe AIR",Y=z.flash.system.Capabilities.os):e(z=v.phantom)==H?(V="PhantomJS",T=(z=z.version||null)&&z.major+"."+z.minor+"."+z.patch):"number"==typeof M.documentMode&&(z=/\bTrident\/(\d+)/i.exec(a))&&(T=[T,M.documentMode],(z=+z[1]+4)!=T[1]&&(Q.push("IE "+T[1]+" mode"),U&&(U[1]=""),T[1]=z),T="IE"==V?String(T[1].toFixed(1)):T[0]);Y=Y&&c(Y)}T&&(z=/(?:[ab]|dp|pre|[ab]\d+pre)(?:\d+\+?)?$/i.exec(T)||/(?:alpha|beta)(?: ?\d)?/i.exec(a+";"+(S&&x.appMinorVersion))||/\bMinefield\b/i.test(a)&&"a")&&(R=/b/i.test(z)?"beta":"alpha",T=T.replace(RegExp(z+"\\+?$"),"")+("beta"==R?L:K)+(/\d+\+?/.exec(z)||"")),"Fennec"==V||"Firefox"==V&&/Android|Firefox OS/.test(Y)?V="Firefox Mobile":"Maxthon"==V&&T?T=T.replace(/\.[\d.]+/,".x"):"Silk"==V?(/Mobi/i.test(a)||(Y="Android",Q.unshift("desktop mode")),/Accelerated *= *true/i.test(a)&&Q.unshift("accelerated")):"IE"==V&&(z=(/; *(?:XBLWP|ZuneWP)(\d+)/i.exec(a)||0)[1])?(V+=" Mobile",Y="Windows Phone OS "+z+".x",Q.unshift("desktop mode")):/Xbox/i.test(W)?(Y=null,"Xbox 360"==W&&/IEMobile/.test(a)&&Q.unshift("mobile mode")):"Chrome"!=V&&"IE"!=V&&(!V||W||/Browser|Mobi/.test(V))||"Windows CE"!=Y&&!/Mobi/i.test(a)?"IE"==V&&S&&null===v.external?Q.unshift("platform preview"):(/BlackBerry/.test(W)||/BB10/.test(a))&&(z=(RegExp(W.replace(/ +/g," *")+"/([.\\d]+)","i").exec(a)||0)[1]||T)?(z=[z,/BB10/.test(a)],Y=(z[1]?(W=null,X="BlackBerry"):"Device Software")+" "+z[0],T=null):this!=d&&"Wii"!=W&&(S&&N||/Opera/.test(V)&&/\b(?:MSIE|Firefox)\b/i.test(a)||"Firefox"==V&&/OS X (?:\d+\.){2,}/.test(Y)||"IE"==V&&(Y&&!/^Win/.test(Y)&&T>5.5||/Windows XP/.test(Y)&&T>8||8==T&&!/Trident/.test(a)))&&!o.test(z=j.call(d,a.replace(o,"")+";"))&&z.name&&(z="ing as "+z.name+((z=z.version)?" "+z:""),o.test(V)?(/IE/.test(z)&&"Mac OS"==Y&&(Y=null),z="identify"+z):(z="mask"+z,V=O?c(O.replace(/([a-z])([A-Z])/g,"$1 $2")):"Opera",/IE/.test(z)&&(Y=null),S||(T=null)),U=["Presto"],Q.push(z)):V+=" Mobile",(z=(/\bAppleWebKit\/([\d.]+\+?)/i.exec(a)||0)[1])&&(z=[parseFloat(z.replace(/\.(\d)$/,".0$1")),z],"Safari"==V&&"+"==z[1].slice(-1)?(V="WebKit Nightly",R="alpha",T=z[1].slice(0,-1)):(T==z[1]||T==(z[2]=(/\bSafari\/([\d.]+\+?)/i.exec(a)||0)[1]))&&(T=null),z[1]=(/\bChrome\/([\d.]+)/i.exec(a)||0)[1],537.36==z[0]&&537.36==z[2]&&parseFloat(z[1])>=28&&(U=["Blink"]),S&&(C||z[1])?(U&&(U[1]="like Chrome"),z=z[1]||(z=z[0],530>z?1:532>z?2:532.05>z?3:533>z?4:534.03>z?5:534.07>z?6:534.1>z?7:534.13>z?8:534.16>z?9:534.24>z?10:534.3>z?11:535.01>z?12:535.02>z?"13+":535.07>z?15:535.11>z?16:535.19>z?17:536.05>z?18:536.1>z?19:537.01>z?20:537.11>z?"21+":537.13>z?23:537.18>z?24:537.24>z?25:537.36>z?26:"Blink"!=U?"27":"28")):(U&&(U[1]="like Safari"),z=z[0],z=400>z?1:500>z?2:526>z?3:533>z?4:534>z?"4+":535>z?5:537>z?6:538>z?7:"7"),U&&(U[1]+=" "+(z+="number"==typeof z?".x":/[.+]/.test(z)?"":"+")),"Safari"==V&&(!T||parseInt(T)>45)&&(T=z)),"Opera"==V&&(z=/(?:zbov|zvav)$/.exec(Y))?(V+=" ",Q.unshift("desktop mode"),"zvav"==z?(V+="Mini",T=null):V+="Mobile"):"Safari"==V&&/Chrome/.exec(U&&U[1])&&(Q.unshift("desktop mode"),V="Chrome Mobile",T=null,/OS X/.test(Y)?(X="Apple",Y="iOS 4.3+"):Y=null),T&&0==T.indexOf(z=/[\d.]+$/.exec(Y))&&a.indexOf("/"+z+"-")>-1&&(Y=i(Y.replace(z,""))),U&&!/Avant|Nook/.test(V)&&(/Browser|Lunascape|Maxthon/.test(V)||/^(?:Adobe|Arora|Midori|Phantom|Rekonq|Rock|Sleipnir|Web)/.test(V)&&U[1])&&(z=U[U.length-1])&&Q.push(z),Q.length&&(Q=["("+Q.join("; ")+")"]),X&&W&&W.indexOf(X)<0&&Q.push("on "+X),W&&Q.push((/^on /.test(Q[Q.length-1])?"":"on ")+W),Y&&(z=/ ([\d.+]+)$/.exec(Y),Y={architecture:32,family:z&&!A?Y.replace(z[0],""):Y,version:z?z[1]:null,toString:function(){var a=this.version;return this.family+(a&&!A?" "+a:"")+(64==this.architecture?" 64-bit":"")}}),(z=/\b(?:AMD|IA|Win|WOW|x86_|x)64\b/i.exec(P))&&!/\bi686\b/i.test(P)&&(Y&&(Y.architecture=64,Y.family=Y.family.replace(RegExp(" *"+z),"")),V&&(/WOW64/i.test(a)||S&&/\w(?:86|32)$/.test(x.cpuClass||x.platform))&&Q.unshift("32-bit")),a||(a=null);var $={};return $.description=a,$.layout=U&&U[0],$.manufacturer=X,$.name=V,$.prerelease=R,$.product=W,$.ua=a,$.version=V&&T,$.os=Y||{architecture:null,family:null,version:null,toString:function(){return"null"}},$.parse=j,$.toString=u,$.version&&Q.unshift(T),$.name&&Q.unshift(V),Y&&V&&(Y!=String(Y).split(" ")[0]||Y!=V.split(" ")[0]&&!W)&&Q.push(W?"("+Y+")":"on "+Y),Q.length&&($.description=Q.join(" ")),$}var k={"function":!0,object:!0},l=k[typeof window]&&window||this,m=l,n=Math.pow(2,53)-1,o=/Opera/,p=this,q=Object.prototype,r=q.hasOwnProperty,s=q.toString;return j()}try{var c=new b}catch(d){$log.log("Unable to get platform info: "+d.message),c={}}return{platform:a}}).config(["$provide",function(a){a.decorator("$exceptionHandler",["$delegate","loupe.logService",function(a,b){return function(c,d){a(c,d),b.exception(c,d)}}])}]);